"use strict";define("compUtils/core/compFactory",["react","lodash","loggingUtils","utils"],function(e,t,r,n){function i(n){var i=a[n];if(!i){var u=t.get(o,[n,"def"]);if(!u)return void r.log.error("Component not implemented: ["+n+"]");var h=e.createClass({mixins:p[n].concat([u])});if(c[n]=h,i=e.createFactory(h),d[n]=i,t.get(o,[n,"isAPIComp"])){var m=s(n,h);a[n]=e.createFactory(m)}else a[n]=i}}var s,o={},p={},a={},d={},c={};return n.sessionFreezer.freeze(o),n.sessionFreezer.freeze(p),n.sessionFreezer.freeze(a),n.sessionFreezer.freeze(d),n.sessionFreezer.freeze(c),{getCompClass:function(e,t){return i(e),t?d[e]:a[e]},getCompReactClass:function(e){return this.getCompClass(e),c[e]},invalidate:function(e){delete a[e]},extend:function(e,n){if(!o.hasOwnProperty(e))return void r.log.error("Trying to extend component ["+e+"] but the component is not defined");p[e]=t.union(p[e].concat(n))},register:function(e,t,r){return o[e]={def:t,isAPIComp:r},p[e]=[],this},registerMobxObserver:function(e){return s=e,this},keys:function(){return t.keys(o)}}}),define("compUtils/core/mobxObserverWrapper",["lodash","react","mobx-react","utils","coreUtils","compUtils/core/compFactory","santaProps","experiment"],function(e,t,r,n,i,s,o,p){function a(e,t){var r=e.getRootIdsWhichShouldBeRendered();return n.componentUtils.shouldBeRendered(r,t)}function d(e,t,r,n){h(e,t,r,n)}function c(e,t,r){h(e,[],t,r)}function u(e){return e&&(e.children||e.components)}function h(e,t,r,n){if(n&&t.length>0){var i=e.getSiteAspect("actionsAspect"),s=e.getSiteAspect("behaviorsAspect");i.registerBehaviors(n,r,t),s.setBehaviorsForActions(s.convertBehaviors(t,n),r,n)}}function m(e,t){e.registerReLayoutPending(t)}function l(e){e.reLayoutIfPending&&this.callAfterRenderDone(e.reLayoutIfPending)}function g(t,r,n,i){var s={};if(t.id===r)s.visibility="hidden",P(t.type)&&(s.width=n.getSiteWidth(),a(i,r)||(s.display="none"));else{var o=n.isPageLandingPage(n.getPrimaryPageId())&&"masterPage"===r,d=e.includes(D,t.componentType);o&&(d?p.isOpen("sv_partialReLayout")&&(s={top:0}):s={display:"none"})}return s}function f(t){var r=t?t.get():null;return e.omitBy(r,function(t,r){return e.isNil(t)||e.isUndefined(t)||"compBehaviors"===r&&e.isEmpty(t)})}function v(e){return"SITE_PAGES"===e}function P(t){return e.includes(["Page","Document"],t)}function y(t,r,n){n[r.id]&&e.get(r,"layout.docked")&&(t.dimentions=n[r.id],t.style.width&&(t.style.width=n[r.id].width),t.style.height&&(t.style.height=n[r.id].height))}function b(t,r,n){var i=t.mobxObserverWrapperProps.siteAPI,s=i.getSiteData(),o=t.mobxObserverWrapperProps.viewerPrivateServices,p=k.getCompProps(t.structure,i,t.rootId,o);if(p.pageStub=P(t.structure.type)&&!a(i,t.rootId),e.get(t,"mobxObserverWrapperProps.dimensionsMap")&&y(p,t.structure,t.mobxObserverWrapperProps.dimensionsMap),t.mobxObserverWrapperProps.applyStyleOverrides){var d=g(t.structure,t.rootId,s,i);p.style=e.merge(p.style||{},d)}return v(t.structure.id)&&e.assign(p,t.mobxObserverWrapperProps.propsForSitePages),p.isAffectedByModeChanges=r,n&&(p.className=(p.className||"")+" transitioning-comp"),p}function C(e,t){return"SantaTypeObserver("+(e.displayName||e.name||t.split(".").pop())+")"}function A(e){return e&&s.getCompClass(e)||t.DOM.div}function I(t,r,n,i,s,o,p,a){var d=s&&R(t,i),c=r||d,u=c&&!!p,h=a===z.TRANSITION,m=h||u,l=b(o,c,m),g=T(t,n,l.pageStub);return l.childrenSet=e.zipObject(e.map(g,"id"),g),l}function O(t,r){var i;return!!e.includes(B,r.componentType)||(i=n.dataUtils.getChildrenData(r,t),e.some(i,O.bind(null,t)))}function T(t,r,i){var s=n.dataUtils.getChildrenData(t,r);return i&&(s=e.filter(s,O.bind(null,r))),s}function x(t){return!e.isEmpty(t)}function F(t,r,n,i){var s=u(r),o=e.map(s,function(e){var r=i&&R(e,n);return t||r});return e.zipObject(e.map(s,"id"),o)}function S(t,r,n){var i={},s=t.childrenSet||[],o=r.childrenSet;return e.forEach(o,function(e,t){!!s[t]||(i[t]=z.ENTER)}),e.forEach(s,function(e,t){o[t]?n[t]&&(i[t]=z.TRANSITION):i[t]=z.LEAVE}),i}function R(t,r){var n=[],i=e.get(t,"modes.definitions");if(i&&i.length){var s=e.map(i,"modeId"),o=e.keys(r);n=e.intersection(o,s)}return!e.isEmpty(n)}function E(t,r,n,i,s){if(!i)return{};var o=t.getSiteAspect("windowScrollEvent"),p=o.getScrollPosition(),a=e.partial(e.isEqual,z.TRANSITION);return e(n).pickBy(a).mapValues(function(t,n){var o=i.shownInFixed[n]?i.absoluteLeft[n]-p.x:i.absoluteLeft[n]-s.getSiteX()-p.x;return{width:i.width[n],height:i.height[n],left:o,top:i.absoluteTop[n]-p.y,rotation:e.get(e.find(u(r.structure),{id:n}),"layout.rotationInDegrees")}}).value()}function W(e,t,r,n,i,s){t.getSiteAspect("actionsAspect").executeAction("modeChange",L.MODE_CHANGED_INIT,{modeChanges:r,componentAnimations:n,transitioningComponentsPrevLayout:i,pageId:e,onComplete:s})}function w(t,r){return e.filter(t,function(e){return r[e.id]})}function M(t,r,n,i){var s=t.childrenSet,o=r.childrenSet,p=w(n,i);return p=e.zipObject(e.map(p,"id"),p),e.assign(s,p,o)}function N(t,r,n,i){return e.values(M(t,r,n,i))}function U(e){e.getSiteAspect("actionsAspect").executeAction("modeChange",L.MODE_CHANGED_EXECUTE)}var D=["wysiwyg.viewer.components.PageGroup","wysiwyg.viewer.components.PagesContainer"],L=n.triggerTypesConsts,k=o.componentPropsBuilder,B=["wysiwyg.viewer.components.tpapps.TPAGluedWidget","wysiwyg.viewer.components.tpapps.TPASection","wysiwyg.viewer.components.tpapps.TPAMultiSection","wysiwyg.viewer.components.tpapps.TPAWidget"],z={ENTER:n.siteConstants.Animations.Modes.AnimationType.ENTER,LEAVE:n.siteConstants.Animations.Modes.AnimationType.LEAVE,TRANSITION:n.siteConstants.Animations.Modes.AnimationType.TRANSITION};return function(n,s){return r.observer(t.createClass({displayName:C(s,n),mixins:[i.renderDoneMixin],propTypes:{structure:t.PropTypes.object,rootId:t.PropTypes.string,key:t.PropTypes.string,ref:t.PropTypes.string,mobxObserverWrapperProps:t.PropTypes.object,applyStyleOverrides:t.PropTypes.bool},componentWillMount:function(){this.transitioningChildrenPrevLayout={},this.currentlyAnimatingChildren={},this.childrenAnimations={},this.prevCompProps={},this.renderedCompProps={},this.childrenToRender={},this.isTrackingComputedProps=!1,this.descendantsFinishedAnimation=!1},componentWillUnmount:function(){c(this.props.mobxObserverWrapperProps.siteAPI,this.renderedCompProps.rootId,this.renderedCompProps.structure.id)},componentDidMount:function(){l.call(this,this.props.mobxObserverWrapperProps.siteAPI)},componentDidUpdate:function(){var t=this.props.mobxObserverWrapperProps.siteAPI;if(!e.isEmpty(this.childrenAnimations)){var r=this.props.mobxObserverWrapperProps.modeChangesInPage;W(this.props.rootId,t,r,this.childrenAnimations,this.transitioningChildrenPrevLayout,this.handleModeChangeAnimationsFinished),U(t),this.childrenAnimations={},this.transitioningChildrenPrevLayout={}}l.call(this,t)},assignComputedProps:function(t){var r=f(t.computedProps);this.isTrackingComputedProps=!!t.computedProps;var n=e.omit(t,["computedProps","getObservableUpdateIndex","getLastFullRenderUpdateIndex"]);return r&&t.getObservableUpdateIndex&&t.getLastFullRenderUpdateIndex&&t.getObservableUpdateIndex()>=t.getLastFullRenderUpdateIndex()&&e.assign(n,r),n},updateRenderedCompPropsMap:function(t){var r=this.prevCompProps,n=t.mobxObserverWrapperProps.siteAPI,i=t.mobxObserverWrapperProps.modeChangesInPage,s=this.currentlyAnimatingChildren,o=!e.isEmpty(i),p=I(t.structure,t.mobxObserverWrapperProps.anyChangeInParentActiveModes,n.getSiteData().isMobileView(),i,o,t,r,t.mobxObserverWrapperProps.compAnimationType);if(p=this.assignComputedProps(p),o){this.descendantsFinishedAnimation=!1;var a=F(p.isAffectedByModeChanges,t.structure,i,o);this.childrenAnimations=S(r,p,a),this.transitioningChildrenPrevLayout=E(n,r,this.childrenAnimations,t.mobxObserverWrapperProps.measureMap,n.getSiteData()),e.assign(s,this.childrenAnimations),e.isEmpty(this.childrenAnimations)||W(t.rootId,n,i,this.childrenAnimations,this.transitioningChildrenPrevLayout,this.handleModeChangeAnimationsFinished)}x(s)?this.childrenToRender=N(r,p,this.childrenToRender,s):(this.childrenToRender=e.values(p.childrenSet),p.isAffectedByModeChanges&&e.isEmpty(this.childrenToRender)&&this.reportAnimationDone()),this.renderedCompProps=p,this.prevCompProps=p},compRefFunction:function(e){this.addRefFunction&&this.addRefFunction(e)},reportAnimationDone:function(){P(this.props.structure.type)?this.props.mobxObserverWrapperProps.rerenderOnModeChangeCompletion():this.props.mobxObserverWrapperProps.descendantsFinishedAnimationCallback()},descendantsFinishedAnimationCallback:function(){this.descendantsFinishedAnimation=!0,x(this.currentlyAnimatingChildren)||this.reportAnimationDone()},getChildProps:function(t){var r=e.assign({},this.props.mobxObserverWrapperProps,{anyChangeInParentActiveModes:this.renderedCompProps.isAffectedByModeChanges,compAnimationType:this.childrenAnimations[t.id],descendantsFinishedAnimationCallback:this.descendantsFinishedAnimationCallback});return{structure:t,rootId:this.props.rootId,mobxObserverWrapperProps:r,key:t.id,refInParent:t.id,pageStub:this.props.pageStub||this.renderedCompProps.pageStub}},getCompFinalProps:function(){this.addRefFunction=this.props.mobxObserverWrapperProps.addComponentRef,this.addRefFunction&&(this.addRefFunction=e.partialRight(this.addRefFunction,this.props.structure.id)),this.renderedCompProps.ref=this.compRefFunction;var t=e.assign({},this.props,this.renderedCompProps);return delete t.mobxObserverWrapperProps,t},render:function(){this.updateRenderedCompPropsMap(this.props),d(this.props.mobxObserverWrapperProps.siteAPI,this.renderedCompProps.compBehaviors,this.renderedCompProps.rootId,this.renderedCompProps.structure.id),this.isTrackingComputedProps&&m(this.props.mobxObserverWrapperProps.siteAPI,this.renderedCompProps.structure.id);var r=e.map(this.childrenToRender,function(e){return A(e.componentType)(this.getChildProps(e))}.bind(this)),n=this.getCompFinalProps();return t.createElement(s,n,r)},handleModeChangeAnimationsFinished:function(t){this.currentlyAnimatingChildren=e.omit(this.currentlyAnimatingChildren,e.keys(t)),!x(this.currentlyAnimatingChildren)&&this.descendantsFinishedAnimation&&this.reportAnimationDone()}}))}}),define("compUtils",["compUtils/core/compFactory","compUtils/core/mobxObserverWrapper"],function(e,t){return{compFactory:e,mobxObserverWrapper:t}});
//# sourceMappingURL=compUtils.min.js.map